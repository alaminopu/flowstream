<script total>

	exports.name = 'Battery';
	exports.icon = 'fal fa-battery-full';
	exports.config = {};
	exports.inputs = [{ id: 'message', name: 'Message' }];
	exports.outputs = [{ id: 'output', name: 'Output' }];

	exports.make = function(instance) {

		var prev;

		instance.message = function($) {
			var msg = $.data;
			var value = (msg.percentage * 100).floor(1);
			if (prev !== value) {
				prev = value;
				$.send('output', value);
				$.status(value);
				$.dashboard(value);
			}
		};

	};

</script>

<settings>
	SETTINGS
</settings>

<style>
	.fbatterystatus span { display: block; margin: 3px 0 5px; font-size: 16px; color: #A0A0A0; }
	.fbatterystatus div { border-radius: 100px; height: 10px; }
</style>

<body>
	<div><i class="fal fa-battery-full mr5"></i>Battery status</div>
	<div class="fbatterystatus" data-bind="?.status.{0}__exec:fbatterystatus__html span:(value || DEF.empty) + '%'"><span></span><div></div></div>
</body>

<script>
	W.fbatterystatus = function(value, path, el) {
		var div = el.find('div');
		var color = '';

		if (value < 20)
			color = '#E8483F';
		else if (value < 50)
			color = '#EC8632';
		else if (value < 70)
			color = '#83C83C';
		else
			color = '#A4FB4E';

		if (value > 100)
			value = 100;

		div.closest('.component').css('border-color', color);
		div.css('background', color);
		div.stop().animate({ width: (value >> 0) + '%' }, 300);
	};
</script>