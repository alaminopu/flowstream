<style>
	.d-battery { font-size: 100%; }
	.d-battery .progress { fill: transparent; stroke-width: 10; stroke-dasharray: 534; stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
	.d-battery .percentage { position: absolute; text-align: center; left: 0; top: 0; padding-left: 5px; }
	.d-battery .percentage sup { color: #777; }
	.d-battery .percentage span { font-weight: bold; }
	.d-battery svg { margin: 10px 0 0 0; }
</style>

<body>
	<div class="centered">
		<div>
			<div class="body">
				<div class="percentage"><span></span><sup>Offline</sup></div>
				<svg viewbox="-5 -5 200 200">
					<circle cx="95" cy="95" r="85" fill="transparent" stroke="#F8FBF9" stroke-width="10" transform="rotate(-90, 95, 95)" />
				</svg>
			</div>
		</div>
	</div>
</body>

<settings>
	<div class="padding">
		<div data---="checkbox__?.isvisible">Visible</div>
	</div>
</settings>

<script>

	exports.id = 'battery';
	exports.icon = 'fa fa-battery-half';
	exports.name = 'Battery';
	exports.config = {};

	exports.make = function(instance, el) {

		var svg = el.find('svg');
		var circle = svg.asvg('circle');
		var percentage = el.find('.percentage');

		circle.attr('cx', '95');
		circle.attr('cy', '95');
		circle.attr('r', '85');
		circle.attr('transform', 'rotate(-90, 95, 95)');
		circle.aclass('progress');

		var self = this;

		var resize = function() {

			var min = Math.min(self.width, self.height);

			// el.css('font-size', (min / 100) * 13 >> 0 + 'px');
			// el.find('sup').css('font-size', ((min / 100) * 8 >> 0) + 'px');
			svg.attr({ width: (self.width / 100) * 80 >> 0, height: ((self.height - 2) / 100) * 80 >> 0 });
			percentage.css({ width: self.width, height: self.height - 2, 'line-height': self.height + 'px' });
		};

		resize();

		instance.data = function(type, msg, el) {
			if (msg.component === 'battery') {
				var value = msg.data;
				var icon = value.between({ '90-': 'full', '60-90': 'three-quarters', '40-60': 'half', '10-40': 'quarter', '-10': 'empty' });

				var color = value.between({ '90-': '#62cc6b', '60-90': '#62cc6b', '40-60': '#d7cd17', '15-40': 'orange', '-15': '#ff4c4c' });

				var radius = Math.PI * (85 * 2);
				circle.attr('stroke', color);
				circle[0].style.strokeDashoffset = ((100 - value) / 100) * radius;

				percentage.find('span').html(value + '');
				percentage.find('sup').html(value ? '%' : 'Offline');
			}
		};

		instance.resize = function() {
			resize();
		};

		instance.configure = function(config, element) {
			console.log(config);
		};

		// var test = () => instance.data('', { component: 'battery', data: Math.random() * 100 >> 0 }, el);

		// setInterval(test, 2000);
		// test();

	};

</script>